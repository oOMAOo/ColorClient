cmake_minimum_required(VERSION 3.19)
project(color_client LANGUAGES CXX)

find_package(Qt6 6.5 REQUIRED COMPONENTS Core Widgets)

qt_standard_project_setup()

# 设置 OpenCV 路径
set(OpenCV_ROOT ${CMAKE_CURRENT_SOURCE_DIR}/dep/opencv)
set(OpenCV_INCLUDE_DIR ${OpenCV_ROOT}/include)
set(OpenCV_LIB_DIR ${OpenCV_ROOT}/lib)
set(OpenCV_BIN_DIR ${OpenCV_ROOT}/bin)

# 查找文件
file(GLOB UI_FILES "${CMAKE_CURRENT_SOURCE_DIR}/src/gui/*.ui")
file(GLOB MOC_FILES "${CMAKE_CURRENT_SOURCE_DIR}/include/*.h")
file(GLOB SRC_FILES "${CMAKE_CURRENT_SOURCE_DIR}/src/gui/*.cpp")

# 添加Qt相关文件
qt_add_executable(${PROJECT_NAME}
    WIN32 MACOSX_BUNDLE
    main.cpp
    ${MOC_FILES}
    ${SRC_FILES}
    ${UI_FILES}
)

# 定义 GNU 标准安装目录结构
include(GNUInstallDirs)
# 设置安装路径
message("CMAKE_INSTALL_BINDIR" ${CMAKE_INSTALL_BINDIR})

install(TARGETS ${PROJECT_NAME}
    BUNDLE  DESTINATION .
    RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
    LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
)

# 加入 Opencv 头文件目录
target_include_directories(${PROJECT_NAME} PRIVATE
    ${CMAKE_CURRENT_SOURCE_DIR}/include
    ${OpenCV_INCLUDE_DIR}
)
# 加入 Opencv 链接库目录
target_link_directories(${PROJECT_NAME} PRIVATE ${OpenCV_LIB_DIR})


find_package(Qt6 REQUIRED COMPONENTS)

target_link_libraries(${PROJECT_NAME}
    PRIVATE
        Qt::Core
        Qt::Widgets
)

target_link_libraries(${PROJECT_NAME} PRIVATE opencv_world480 opencv_img_hash480)

file(GLOB DEP_OPENCV_BIN_FILES "${OpenCV_BIN_DIR}/*.dll")


file(COPY ${DEP_OPENCV_BIN_FILES} DESTINATION ${CMAKE_RUNTIME_OUTPUT_DIRECTORY})
qt_generate_deploy_app_script(
    TARGET ${PROJECT_NAME}
    OUTPUT_SCRIPT deploy_script
    NO_UNSUPPORTED_PLATFORM_ERROR
)
install(SCRIPT ${deploy_script})
